<!DOCTYPE html>
<html>
<head>
  <title>Check User</title>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const supabaseUrl = 'https://quommltnnefywvgwqfum.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF1b21tbHRubmVmeXd2Z3dxZnVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1MjYxMDksImV4cCI6MjA3NTEwMjEwOX0.rZOZStiP41x03JJqu6zcsO4OUZPl0Uf6P_qjGC1btfw';

    const supabase = createClient(supabaseUrl, supabaseKey);

    async function checkUser() {
      const { data: { user } } = await supabase.auth.getUser();
      console.log('Current user:', user);

      if (user) {
        const { data: userData, error } = await supabase
          .from('users')
          .select('*')
          .eq('id', user.id)
          .single();

        console.log('User data from users table:', userData);
        console.log('Error:', error);

        document.getElementById('output').innerHTML = `
          <pre>${JSON.stringify({ user, userData, error }, null, 2)}</pre>
        `;

        // Try to insert a test booking
        const { data: bookingData, error: bookingError } = await supabase
          .from('bookings')
          .insert({
            student_id: user.id,
            aircraft_id: '00000000-0000-0000-0000-000000000001',
            start_time: new Date().toISOString(),
            end_time: new Date(Date.now() + 3600000).toISOString(),
            payment_type: 'prepaid',
            status: 'confirmed'
          })
          .select();

        console.log('Test booking result:', bookingData);
        console.log('Test booking error:', bookingError);

        document.getElementById('booking-test').innerHTML = `
          <h3>Booking Test Result:</h3>
          <pre>${JSON.stringify({ bookingData, bookingError }, null, 2)}</pre>
        `;
      }
    }

    checkUser();
  </script>
</head>
<body>
  <h1>User Check</h1>
  <div id="output">Loading...</div>
  <div id="booking-test"></div>
</body>
</html>
